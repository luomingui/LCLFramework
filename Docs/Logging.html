<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" />
    <title>Logger-LCL框架文档</title>
    <link href="css/bootstrap.min.css" rel="stylesheet" type="text/css" />
    <link href="css/lcl.css" rel="stylesheet" type="text/css" />
</head>

<body>
    <div class="navheader">
        <table width="100%" summary="Navigation header">
            <tr>
                <th colspan="3" align="center" style="text-align: center;">Logger</th>
            </tr>
            <tr>
                <td width="20%" align="left">
                    <a accesskey="p" href="Autofac.html">Prev</a>&nbsp;
                </td>
                <th width="60%" align="center">&nbsp;</th>
                <td width="20%" align="right">
                    &nbsp;
                    <a accesskey="n" href="Caching.html">Next</a>
                </td>
            </tr>
        </table><hr />
    </div>

    <div class="document-contents">
        <h3 id="DocServerSide">日志</h3>
        <p>LCL日志提供了一个公共接口，如果需要的话，可以很容易的更改它</p>
        <h4>使用日志 示例：</h4>
        <pre lang="cs">
        <strong>Logger.LogInfo("就一行是不是很简单 ");</strong>
        </pre>
        <h4>默认实现的日志接口：</h4>
        <ul>
            <li>file</li>
            <li>system event</li>
            <li>trace</li>
        </ul>
        <h4>自定义日志：</h4>
        <p>实现自己的日志需要继承LoggerBase类 如下示例：</p>
        <pre lang="cs">
    public class FileLogger : LoggerBase
    {
      
        public override void LogInfo(string message)
        {
            string msg = string.Format(@"{0}|{1}|Inform|{2}" + Environment.NewLine, DateTime.Now, 
Thread.CurrentThread.ManagedThreadId, message);
            AppendAllText(msg);
        }
      
        public override void LogWarn(string message)
        {
            string msg = string.Format(@"{0}|{1}|Warn|{2}" + Environment.NewLine, DateTime.Now, 
Thread.CurrentThread.ManagedThreadId, message);
            AppendAllText(msg, LogType.Warn);
        }
     
        public override void LogDebug(string message)
        {
            string msg = string.Format(@"{0}|{1}|Debug|{2}" + Environment.NewLine, DateTime.Now, 
Thread.CurrentThread.ManagedThreadId, message);
            AppendAllText(msg, LogType.Debug);
        }
        public override void LogError(string title, Exception e)
        {
            var stackTrace = e.StackTrace;
            e = e.GetBaseException();
            string msg = string.Format(@"{0}|{1}|Error|{2}" + Environment.NewLine, DateTime.Now, 
Thread.CurrentThread.ManagedThreadId, title + e.ToString());
            AppendAllText(msg, LogType.Error);
        }
        public override void LogDbAccessed(string sql, IDbDataParameter[] parameters, 
DbConnectionSchema connectionSchema)
        {
            var content = sql;
            if (parameters.Length > 0)
            {
                var pValues = parameters.Select(p =>
                {
                    var value = p.Value;
                    if (value is string)
                    {
                        value = '"' + value.ToString() + '"';
                    }
                    return value;
                });
                content += Environment.NewLine + "Parameters:" + string.Join(",", pValues);
            }
            content = DateTime.Now + Environment.NewLine + "Database:  " + connectionSchema.Database +
 Environment.NewLine + content + "\r\n\r\n\r\n";
            AppendAllText(content, LogType.Trace);
        }
        private void AppendAllText(string contents, LogType logType = LogType.Info)
        {
            string path = AppDomain.CurrentDomain.SetupInformation.ApplicationBase + "/" 
+ EngineContext.Current.Resolve《lconfig》().LoggerPath;
            string logfile = path + "/" + logType + DateTime.Now.ToString("yyyyMMdd") + "log.log";
            if (!Directory.Exists(path))
            {
                Directory.CreateDirectory(path);
            }
            File.AppendAllText(logfile, contents);
        }
    }
     </pre>
        <h4>注入自定义的日志：</h4>
        <p>在项目启动的地方注入自定义日志就可以了，如在Global.asax文件中写入如下代码</p>
        <pre>
public class MvcApplication : System.Web.HttpApplication
{
    protected void Application_Start()
    {
        Logger.SetImplementation(new FileLogger());
    }
}
</pre>


    </div>

    <div class="navfooter">
        <hr /><table width="100%" summary="Navigation footer">
            <tr>
                <td width="40%" align="left"><a accesskey="p" href="Autofac.html">Prev</a>&nbsp;</td>
                <td width="20%" align="center"><a accesskey="h" href="index.html">Home</a>&nbsp;</td>
                <td width="40%" align="right"><a accesskey="n" href="Caching.html">Next</a>&nbsp;</td>
            </tr>
        </table>
    </div>

</body>
</html>
